<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>æ¥é€é ç´„è¡¨å–®</title>
<style>
body{margin:0;padding:16px;background:#111827;color:#f3f4f6;font-family:system-ui;}
.container{max-width:560px;margin:auto;background:#1f2937;padding:20px;border-radius:14px;}
h2{text-align:center;margin-bottom:20px;}
label{display:block;margin-top:16px;font-weight:600;}
input,select{width:100%;height:44px;padding:8px 12px;border-radius:10px;border:1px solid #4b5563;background:#374151;color:#f3f4f6;font-size:16px;box-sizing:border-box;}
.note{margin-top:6px;font-size:14px;}
.note.danger{color:#f87171;font-weight:600;}
button{margin-top:16px;width:100%;height:48px;border:none;border-radius:12px;background:#059669;color:#fff;font-size:16px;font-weight:600;cursor:pointer;}
.via-container{display:flex;flex-direction:column;gap:8px;}
.add-via-btn{margin-top:8px;background:#374151;color:#e5e7eb;border:1px dashed #6b7280;border-radius:10px;height:44px;width:100%;box-sizing:border-box;}
.time-selects{display:flex;gap:8px;flex-wrap:wrap;}
.time-selects select{flex:1 1 48%;min-width:100px;}
@media(max-width:480px){
  input,select,button{font-size:15px;height:40px;padding:6px 10px;}
}
</style>
</head>
<body>
<div class="container">
<h2>ğŸš— æ¥é€é ç´„è¡¨å–®</h2>
<form id="bookingForm">

<label>ğŸ“… æ—¥æœŸ</label>
<input type="date" name="date" id="dateInput" required>

<label>âœˆï¸ èˆªç­æ™‚é–“</label>
<div class="time-selects">
  <select id="flightHour" required><option value="">æ™‚</option></select>
  <select id="flightMinute" required><option value="">åˆ†</option></select>
</div>

<label>ğŸ•’ å»ºè­°å‡ºç™¼æ™‚é–“</label>
<select name="time" id="departureTimeSelect" required></select>
<div class="note danger">âš ï¸ å»ºè­°æå‰ 2 å°æ™‚æŠµé”æ©Ÿå ´</div>

<label>âœˆï¸ èˆªç­ç·¨è™Ÿ</label>
<input type="text" name="flight" placeholder="CI123">

<label>ğŸ“ å‡ºç™¼åœ°</label>
<input type="text" name="start" required>

<label>ğŸ›£ï¸ ä¸­é€”åœé </label>
<div id="viaList" class="via-container">
  <input type="text" class="via-item" placeholder="è¼¸å…¥ä¸­é€”åœ°å€">
</div>
<button type="button" class="add-via-btn" id="addViaBtn">â• æ–°å¢åœé é»</button>

<label>ğŸ ç›®çš„åœ°</label>
<select name="end" id="endSelect" required>
  <option value="">è«‹é¸æ“‡</option>
  <option value="æ¡ƒåœ’åœ‹éš›æ©Ÿå ´">æ¡ƒåœ’åœ‹éš›æ©Ÿå ´</option>
  <option value="è‡ªè¨‚">è‡ªè¨‚åœ°å€</option>
</select>
<input type="text" id="customEnd" placeholder="è«‹è¼¸å…¥ç›®çš„åœ°åœ°å€" style="display:none;margin-top:8px">

<div id="terminalBlock" style="display:none;">
  <label>ğŸ›« èˆªå»ˆ</label>
  <select name="terminal">
    <option value="">è«‹é¸æ“‡</option>
    <option value="T1">T1</option>
    <option value="T2">T2</option>
  </select>
</div>

<label>ğŸš˜ è»Šå‹</label>
<select name="car" required>
  <option value="">è«‹é¸æ“‡</option>
  <option value="èˆ’é©è½è»Š">èˆ’é©è½è»Šï¼ˆ1â€“2 ä»¶è¡Œæï¼‰</option>
  <option value="äº”åº§ä¼‘æ—…">äº”åº§ä¼‘æ—…ï¼ˆ3â€“4 ä»¶è¡Œæï¼‰</option>
  <option value="7äººåº§">7 äººåº§ï¼ˆ3â€“4 ä»¶è¡Œæï¼‰</option>
  <option value="8-9åº§å¤§è»Š">8â€“9 åº§å¤§è»Šï¼ˆ6 ä»¶ä»¥ä¸Šè¡Œæï¼‰</option>
</select>

<label>ğŸ‘¶ å…’ç«¥åº§æ¤…</label>
<select name="childSeatType" id="childSeatType">
  <option value="ä¸éœ€è¦">ä¸éœ€è¦</option>
  <option value="å®‰å…¨åº§æ¤…">å®‰å…¨åº§æ¤…</option>
  <option value="å¢é«˜å¢Š">å¢é«˜å¢Š</option>
</select>
<input type="number" name="childSeatQty" id="childSeatQty" min="1" placeholder="æ•¸é‡" style="display:none;margin-top:8px">
<div class="note danger">âš ï¸ ä¾å°ç£æ³•è¦ï¼Œ4 æ­²ä»¥ä¸‹æˆ–èº«é«˜æœªæ»¿ 135 å…¬åˆ†ä¹‹å…’ç«¥é ˆä½¿ç”¨é©åˆä¹‹å®‰å…¨åº§æ¤…</div>

<label>ğŸ™‹ å§“å</label>
<input type="text" name="name" required>

<label>ğŸ“ é›»è©±</label>
<input type="tel" name="phone" required>

<button type="submit">âœ… é€å‡ºé ç´„</button>
</form>
<div id="msg" style="margin-top:16px;"></div>
</div>

<script>
// æ—¥æœŸé è¨­ä»Šå¤©
document.getElementById("dateInput").value=new Date().toISOString().slice(0,10);

// ç”Ÿæˆèˆªç­æ™‚é–“ä¸‹æ‹‰
const flightHour=document.getElementById("flightHour");
for(let h=0;h<24;h++){
  const opt=document.createElement("option");
  opt.value=opt.textContent=h.toString().padStart(2,'0');
  flightHour.appendChild(opt);
}
const flightMinute=document.getElementById("flightMinute");
for(let m=0;m<60;m+=5){
  const opt=document.createElement("option");
  opt.value=opt.textContent=m.toString().padStart(2,'0');
  flightMinute.appendChild(opt);
}

// å‡ºç™¼æ™‚é–“ä¸‹æ‹‰ï¼ˆèˆªç­å‰ 4 å°æ™‚ï¼Œæ¯15åˆ†é˜ï¼‰
const departureSelect=document.getElementById("departureTimeSelect");
function updateDepartureOptions(){
  departureSelect.innerHTML="";
  const h=parseInt(flightHour.value);
  const m=parseInt(flightMinute.value);
  if(isNaN(h)||isNaN(m)) return;
  let base=h*60+m;
  for(let offset=240;offset>=0;offset-=15){
    let t=base-offset;
    let cross=false;
    if(t<0){t+=1440; cross=true;}
    const hh=String(Math.floor(t/60)).padStart(2,'0');
    const mm=String(t%60).padStart(2,'0');
    const opt=document.createElement("option");
    opt.value=`${hh}:${mm}`;
    opt.textContent=`${hh}:${mm}`+(cross?"ï¼ˆå‰ä¸€æ—¥ï¼‰":"");
    if(cross) opt.style.color="red";
    departureSelect.appendChild(opt);
  }
}
flightHour.addEventListener("change",updateDepartureOptions);
flightMinute.addEventListener("change",updateDepartureOptions);

// ä¸­é€”åœé 
document.getElementById("addViaBtn").onclick=()=>{
  const i=document.createElement("input");
  i.type="text"; i.className="via-item"; i.placeholder="è¼¸å…¥ä¸­é€”åœ°å€";
  document.getElementById("viaList").appendChild(i);
};

// ç›®çš„åœ°
const endSelect=document.getElementById("endSelect");
const terminalBlock=document.getElementById("terminalBlock");
const customEnd=document.getElementById("customEnd");
endSelect.onchange=()=>{
  terminalBlock.style.display=endSelect.value==="æ¡ƒåœ’åœ‹éš›æ©Ÿå ´"?"block":"none";
  customEnd.style.display=endSelect.value==="è‡ªè¨‚"?"block":"none";
};

// å…’ç«¥åº§æ¤…
const seatType=document.getElementById("childSeatType");
const seatQty=document.getElementById("childSeatQty");
seatType.onchange=()=>{
  seatQty.style.display=seatType.value==="ä¸éœ€è¦"?"none":"block";
  if(seatType.value==="ä¸éœ€è¦") seatQty.value="";
};

// è¡¨å–®é€å‡º
document.getElementById("bookingForm").onsubmit=e=>{
  e.preventDefault();
  const obj={};
  const fd=new FormData(e.target);
  fd.forEach((v,k)=>{
    if(v && v!=="ä¸éœ€è¦") obj[k]=v.trim();
  });
  obj.time=document.getElementById("departureTimeSelect").value;
  obj.flightTime=`${flightHour.value}:${flightMinute.value}`;
  // ä¸­é€”åœé 
  const vias=[...document.querySelectorAll(".via-item")].map(i=>i.value.trim()).filter(Boolean);
  if(vias.length) obj.via=vias.join(" â• ");
  // å…’ç«¥åº§æ¤…
  if(seatType.value!=="ä¸éœ€è¦") obj.childSeat=seatType.value+(seatQty.value?" x"+seatQty.value:"");

  fetch("https://script.google.com/macros/s/AKfycbz2grZc6Btb08fTHZMO94MMkJ5zChNV5fQJRqAHnMcIYU-610BD6iCu5ryPleAZMMo/exec",{
    method:"POST",
    body:new URLSearchParams(obj)
  }).then(r=>r.json())
    .then(r=>document.getElementById("msg").textContent=r.status==="ok"?"âœ… å·²é€å‡º":"âŒ é€å‡ºå¤±æ•—")
    .catch(err=>document.getElementById("msg").textContent="âŒ é€å‡ºå¤±æ•—");
};
</script>
</body>
</html>
