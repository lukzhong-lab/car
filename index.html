<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
  <title>æ¥é€é ç´„è¡¨å–®</title>
  <style>
    * { box-sizing: border-box; }
    html, body { 
      margin: 0; padding: 0; min-height: 100vh; 
      font-family: system-ui, -apple-system, sans-serif; 
      background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
    }
    body { 
      max-width: 100%; padding: 15px; 
      display: flex; flex-direction: column; 
      min-height: 100vh; 
    }
    .container { max-width: 600px; margin: 0 auto; width: 100%; flex: 1; }
    h2 { 
      text-align: center; color: #1a1a1a; 
      margin: 20px 0 30px; font-size: 1.5rem; 
      font-weight: 700; 
    }
    label { 
      display: block; margin: 18px 0 8px; 
      font-weight: 600; color: #333; font-size: 1rem; 
    }
    input, select { 
      width: 100%; padding: 14px 16px; 
      border: 2px solid #e1e5e9; border-radius: 12px; 
      font-size: 16px; background: white; 
      transition: all 0.2s; 
    }
    input:focus, select:focus { 
      outline: none; border-color: #10b981; 
      box-shadow: 0 0 0 4px rgba(16,185,129,0.1); 
    }
    button { 
      width: 100%; padding: 16px; margin-top: 24px; 
      background: linear-gradient(135deg, #10b981, #059669); 
      color: white; border: none; border-radius: 12px; 
      font-size: 1.1rem; font-weight: 600; 
      cursor: pointer; transition: all 0.2s; 
    }
    button:hover:not(:disabled) { transform: translateY(-1px); box-shadow: 0 8px 25px rgba(16,185,129,0.3); }
    button:disabled { background: #9ca3af; cursor: not-allowed; transform: none; }
    #message { 
      padding: 16px; margin-top: 20px; border-radius: 12px; 
      text-align: center; display: none; font-weight: 500; 
    }
    .success { background: #d1fae5; color: #065f46; border: 2px solid #a7f3d0; }
    .error { background: #fee2e2; color: #991b1b; border: 2px solid #fca5a5; }
    .note { 
      font-size: 0.9rem; color: #666; 
      margin: 4px 0 20px; line-height: 1.5; 
      background: rgba(255,255,255,0.8); padding: 12px; 
      border-radius: 8px; border-left: 4px solid #10b981; 
    }
    .loading { text-align: center; color: #666; padding: 40px; }
    @media (max-width: 480px) { 
      body { padding: 10px; } 
      h2 { font-size: 1.3rem; margin: 15px 0 25px; }
      input, select, button { padding: 16px 14px; font-size: 17px; }
    }
  </style>
</head>
<body>
  <div class="container">
    <h2>ğŸš— æ¥é€é ç´„è¡¨å–®</h2>
    
    <form id="bookingForm">
      <label>ğŸ“… æ—¥æœŸ</label>
      <input type="date" id="date" required>
      
      <label>ğŸ•’ æ™‚é–“</label>
      <input type="time" id="time" required>
      
      <label>ğŸ“ å‡ºç™¼åœ°</label>
      <input type="text" id="startAddress" placeholder="è«‹è¼¸å…¥å®Œæ•´åœ°å€ï¼ˆå«ç¸£å¸‚ã€è·¯åã€è™Ÿç¢¼ï¼‰" required>
      
      <label>ğŸ“ ç›®çš„åœ°</label>
      <input type="text" id="endAddress" placeholder="è«‹è¼¸å…¥å®Œæ•´åœ°å€ï¼ˆå«ç¸£å¸‚ã€è·¯åã€è™Ÿç¢¼ï¼‰" required>
      
      <label>ğŸš™ è»Šå‹é¸æ“‡</label>
      <select id="carType" required>
        <option value="">è«‹é¸æ“‡è»Šå‹</option>
        <option value="è½è»Š">è½è»Šï¼ˆ1-4äººï¼‰</option>
        <option value="äº”åº§ä¼‘æ—…">äº”åº§ä¼‘æ—…ï¼ˆ1-5äººï¼‰</option>
        <option value="7äººåº§">7äººåº§ï¼ˆ1-7äººï¼‰</option>
        <option value="8-9åº§å¤§è»Š">8-9åº§å¤§è»Šï¼ˆ1-9äººï¼‰</option>
      </select>
      
      <label>ğŸª‘ éœ€è¦å…’ç«¥å®‰å…¨åº§æ¤…ï¼Ÿ</label>
      <select id="childSeat" required>
        <option value="">è«‹é¸æ“‡</option>
        <option value="æ˜¯">æ˜¯ï¼Œéœ€è¦</option>
        <option value="å¦">å¦ï¼Œä¸éœ€è¦</option>
        <option value="ä¸ç¢ºå®š">ä¸ç¢ºå®šï¼Œè«‹å”åŠ©ç¢ºèª</option>
      </select>
      <div class="note">
        <strong>âš ï¸ æ³•è¦æé†’ï¼š</strong><br>
        0~4æ­²å¹¼ç«¥<strong>å¿…é ˆ</strong>ä½¿ç”¨åˆæ ¼å®‰å…¨åº§æ¤…ï¼ˆå¾Œåº§ï¼‰ï¼Œ4~12æ­²å»ºè­°å¢é«˜å¢Šã€‚<br>
        æœªä½¿ç”¨ç½°æ¬¾ 1,500~3,000 å…ƒï¼Œè«‹ä¾å¹´é½¡/é«”é‡é¸æ“‡ã€‚
      </div>
      
      <label>ğŸ‘¤ å§“å</label>
      <input type="text" id="name" required>
      
      <label>ğŸ“± é›»è©±</label>
      <input type="tel" id="phone" placeholder="0912345678 æˆ– +886912345678" required>
      
      <label>âœ‰ï¸ é›»å­éƒµä»¶ï¼ˆé¸å¡«ï¼Œæ”¶ç¢ºèªä¿¡ï¼‰</label>
      <input type="email" id="email" placeholder="example@gmail.com">
      
      <button type="button" id="submitBtn">âœ… é€å‡ºé ç´„</button>
    </form>
    
    <div id="message"></div>
  </div>

  <!-- EmailJS SDK (defer ç¢ºä¿è¼‰å…¥å®Œæˆ) -->
  <script defer src="https://cdn.jsdelivr.net/npm/@emailjs/browser@4/dist/email.min.js"></script>
  
  <script>
    // å¤šé‡é˜²å‘†ï¼šDOMContentLoaded + SDK ready + setTimeout
    function initApp() {
      if (typeof emailjs === 'undefined') {
        console.warn('EmailJS é‚„æ²’è¼‰å…¥ï¼Œ5ç§’å¾Œé‡è©¦...');
        setTimeout(initApp, 1000);
        return;
      }
      
      console.log('âœ… EmailJS SDK å·²è¼‰å…¥');
      
      // åˆå§‹åŒ– EmailJS
      emailjs.init({ publicKey: "3NaCLzxTOKYgHeXyP" });
      
      // é è¨­ä»Šå¤©æ—¥æœŸ
      const today = new Date().toISOString().slice(0, 10);
      document.getElementById('date').value = today;
      
      const btn = document.getElementById('submitBtn');
      const msgDiv = document.getElementById('message');
      
      btn.addEventListener('click', async () => {
        if (btn.disabled) return;
        
        btn.disabled = true;
        btn.textContent = 'ğŸ“¤ é€å‡ºä¸­...';
        
        const params = {
          date: document.getElementById('date').value,
          time: document.getElementById('time').value,
          start: document.getElementById('startAddress').value.trim(),
          end: document.getElementById('endAddress').value.trim(),
          car: document.getElementById('carType').value,
          childSeat: document.getElementById('childSeat').value,
          name: document.getElementById('name').value.trim(),
          phone: document.getElementById('phone').value.trim(),
          email: document.getElementById('email').value.trim() || 'æœªæä¾›'
        };
        
        // å¿…å¡«æª¢æŸ¥
        const required = ['date','time','start','end','car','childSeat','name','phone'];
        const missing = required.filter(k => !params[k]);
        if (missing.length) {
          showMsg('âŒ è«‹å¡«å¯«æ‰€æœ‰å¿…å¡«æ¬„ä½ï¼', 'error');
          resetBtn();
          return;
        }
        
        console.log('ğŸ“§ é€å‡ºè³‡æ–™ï¼š', params);
        
        try {
          await emailjs.send('service_gd932ui', 'template_53hb8ks', params);
          let msg = 'âœ… é ç´„æˆåŠŸï¼å®Œæ•´è³‡è¨Šå·²å¯„å‡ºï¼Œæˆ‘å€‘æœƒç«‹å³è¯ç¹«ç¢ºèªã€‚<br>ğŸ“§ ';
          msg += params.email !== 'æœªæä¾›' ? `ç¢ºèªä¿¡å·²å¯„è‡³ ${params.email}` : 'è«‹ç•™æ„é›»è©±è¯ç¹«';
          showMsg(msg, 'success');
          
          document.getElementById('bookingForm').reset();
          document.getElementById('date').value = today;
        } catch (err) {
          console.error('EmailJS éŒ¯èª¤ï¼š', err);
          showMsg('âŒ å¯„ä¿¡å¤±æ•—ï¼Œè«‹ç›´æ¥LINE/é›»è©±è¯ç¹«ï¼Œæˆ–é‡æ–°é€å‡ºã€‚<br>è©³æƒ…è«‹æŒ‰ F12 æŸ¥çœ‹ã€‚', 'error');
        } finally {
          setTimeout(() => msgDiv.style.display = 'none', 10000);
          resetBtn();
        }
      });
      
      function showMsg(text, type) {
        msgDiv.innerHTML = text;
        msgDiv.className = type;
        msgDiv.style.display = 'block';
      }
      
      function resetBtn() {
        btn.disabled = false;
        btn.textContent = 'âœ… é€å‡ºé ç´„';
      }
    }
    
    // å¤šé‡è§¸ç™¼ç¢ºä¿è¼‰å…¥
    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', initApp);
    } else {
      initApp();
    }
    window.addEventListener('load', initApp);
  </script>
</body>
</html>