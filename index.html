<!-- ... 前面的 HTML/CSS 保持不變，只改 <script> 部分 -->

<script type="text/javascript">
  const PUBLIC_KEY  = "3NaCLzxTOKYgHeXyP";
  const SERVICE_ID  = "service_gd932ui";
  const TEMPLATE_ID = "template_53hb8ks";

  emailjs.init({ publicKey: PUBLIC_KEY });

  document.getElementById('date').value = new Date().toISOString().slice(0, 10);

  const form = document.getElementById('bookingForm');
  const btn = document.getElementById('submitBtn');
  const msgDiv = document.getElementById('message');

  btn.addEventListener('click', () => {
    if (btn.disabled) return;
    btn.disabled = true;
    btn.textContent = '送出中...';

    const templateParams = {
      date:      document.getElementById('date').value,
      time:      document.getElementById('time').value,
      start:     document.getElementById('startAddress').value.trim(),
      end:       document.getElementById('endAddress').value.trim(),
      car:       document.getElementById('carType').value,
      childSeat: document.getElementById('childSeat').value,
      name:      document.getElementById('name').value.trim(),
      phone:     document.getElementById('phone').value.trim(),
      email:     document.getElementById('email').value.trim() || '未填寫'
    };

    if (!templateParams.date || !templateParams.time || !templateParams.start || 
        !templateParams.end || !templateParams.car || !templateParams.childSeat || 
        !templateParams.name || !templateParams.phone) {
      showMessage('請填寫所有必填欄位！', 'error');
      resetButton();
      return;
    }

    console.log('即將寄出的完整資料（key 必須與模板 {{ }} 匹配）：', JSON.stringify(templateParams, null, 2));

    emailjs.send(SERVICE_ID, TEMPLATE_ID, templateParams)
      .then((response) => {
        console.log('寄信成功！狀態碼：', response.status);
        showMessage(`預約已成功送出！<br>完整資訊已寄出（姓名、電話、地點、車型等全部包含）。<br>若信件未顯示完整，請檢查 EmailJS 模板變數名稱。`, 'success');

        form.reset();
        document.getElementById('date').value = new Date().toISOString().slice(0, 10);
      })
      .catch((err) => {
        console.error('EmailJS 錯誤細節：', err);
        showMessage('寄信失敗，請檢查 F12 Console 錯誤，或直接聯繫我們。', 'error');
      })
      .finally(() => {
        setTimeout(() => { msgDiv.style.display = 'none'; }, 8000);
        resetButton();
      });
  });

  function showMessage(text, type) {
    msgDiv.innerHTML = text;
    msgDiv.className = type;
    msgDiv.style.display = 'block';
  }

  function resetButton() {
    btn.disabled = false;
    btn.textContent = '送出預約';
  }
</script>