<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>æ¥é€é ç´„è¡¨å–®</title>
<style>
body{font-family:system-ui;margin:15px;background:#f5f7fa;}
.container{max-width:600px;margin:0 auto;}
label{display:block;margin:10px 0 3px;font-weight:600;}
input,select,button{width:100%;padding:10px;margin-bottom:10px;border-radius:6px;border:1px solid #ccc;}
button{background:linear-gradient(135deg,#10b981,#059669);color:white;border:none;cursor:pointer;}
button:disabled{background:#9ca3af;cursor:not-allowed;}
#message{display:none;padding:10px;border-radius:6px;margin-top:10px;text-align:center;}
#message.success{background:#d1fae5;color:#065f46;}
#message.error{background:#fee2e2;color:#991b1b;}
</style>
</head>
<body>
<div class="container">
<h2>ğŸš— æ¥é€é ç´„è¡¨å–®</h2>
<form id="bookingForm">
  <label>ğŸ“… æ—¥æœŸ</label>
  <input type="date" id="date" required>

  <label>ğŸ•’ å‡ºç™¼æ™‚é–“</label>
  <input type="time" id="time" required>

  <label>âœˆï¸ èˆªç­è™Ÿç¢¼</label>
  <input type="text" id="flightNumber" required>

  <label>ğŸ¢ èˆªå»ˆ</label>
  <select id="terminal" required>
    <option value="">è«‹é¸èˆªå»ˆ</option>
    <option value="T1">T1</option>
    <option value="T2">T2</option>
    <option value="T3">T3</option>
  </select>

  <label>ğŸ“ å‡ºç™¼åœ°</label>
  <input type="text" id="startAddress" required>

  <label>ğŸ“ ç›®çš„åœ°</label>
  <select id="endAddress" required>
    <option value="">è«‹é¸æ“‡æˆ–è¼¸å…¥</option>
    <option value="æ¡ƒåœ’æ©Ÿå ´">æ¡ƒåœ’æ©Ÿå ´</option>
    <option value="æ¾å±±æ©Ÿå ´">æ¾å±±æ©Ÿå ´</option>
    <option value="å…¶ä»–">å…¶ä»–</option>
  </select>
  <input type="text" id="endAddressCustom" placeholder="è‹¥é¸å…¶ä»–è«‹å¡«å®Œæ•´åœ°å€" style="display:none;margin-top:5px;">

  <label>ğŸš™ è»Šå‹é¸æ“‡ï¼ˆå«è¡Œæåƒè€ƒï¼‰</label>
  <select id="carType" required>
    <option value="">è«‹é¸è»Šå‹</option>
    <option value="èˆ’é©è½è»Šï¼ˆè¡Œæç´„1-2ä»¶ï¼‰">èˆ’é©è½è»Š</option>
    <option value="äº”åº§ä¼‘æ—…ï¼ˆè¡Œæç´„3-4ä»¶ï¼‰">äº”åº§ä¼‘æ—…</option>
    <option value="7äººåº§ï¼ˆè¡Œæç´„3-4ä»¶ï¼‰">7äººåº§</option>
    <option value="8-9åº§å¤§è»Šï¼ˆè¡Œæ6ä»¶ä»¥ä¸Šï¼‰">8-9åº§å¤§è»Š</option>
  </select>

  <label>ğŸ§³ è¡Œæå‚™è¨»ï¼ˆé¸å¡«ï¼‰</label>
  <input type="text" id="luggageNote">

  <label>ğŸª‘ å…’ç«¥å®‰å…¨åº§æ¤… / å¢é«˜å¢Šéœ€æ±‚</label>
  <select id="childSeat" required>
    <option value="">è«‹é¸</option>
    <option value="ä¸éœ€è¦">ä¸éœ€è¦</option>
    <option value="éœ€è¦å®‰å…¨åº§æ¤…">å®‰å…¨åº§æ¤…</option>
    <option value="éœ€è¦å¢é«˜å¢Š">å¢é«˜å¢Š</option>
  </select>

  <label>ğŸ›£ï¸ ä¸­é€”åœé é»ï¼ˆé¸å¡«ï¼‰</label>
  <div id="viaContainer"><input type="text" class="via-input" placeholder="ä¾‹å¦‚ï¼šå°åŒ—è»Šç«™"></div>
  <button type="button" id="addVia">â• æ–°å¢åœé é»</button>

  <label>ğŸ‘¤ å§“å</label>
  <input type="text" id="name" required>

  <label>ğŸ“± é›»è©±</label>
  <input type="tel" id="phone" required>

  <button type="submit">âœ… é€å‡ºé ç´„</button>
</form>

<div id="message"></div>
</div>

<script>
const WEB_APP_URL = "ä½ çš„ Web App URL"; // æ›¿æ›

document.getElementById("date").value=new Date().toISOString().slice(0,10);

const endSelect=document.getElementById("endAddress");
const endCustom=document.getElementById("endAddressCustom");
endSelect.addEventListener("change",()=>{ 
  endCustom.style.display=endSelect.value==="å…¶ä»–"?"block":"none"; 
  endCustom.required=endSelect.value==="å…¶ä»–"; 
  if(endSelect.value!=="å…¶ä»–") endCustom.value="";
});

document.getElementById("addVia").addEventListener("click",()=>{
  const input=document.createElement("input");
  input.type="text";
  input.placeholder="ä¸­é€”åœé åœ°å€ï¼ˆé¸å¡«ï¼‰";
  input.className="via-input";
  document.getElementById("viaContainer").appendChild(input);
});

document.getElementById("bookingForm").addEventListener("submit", async e=>{
  e.preventDefault();
  const btn=e.target.querySelector("button[type=submit]");
  btn.disabled=true;
  btn.textContent="ğŸ“¤ é€å‡ºä¸­...";

  const endValue=endSelect.value==="å…¶ä»–"?endCustom.value.trim():endSelect.value;
  const viaPoints=[...document.getElementsByClassName("via-input")].map(v=>v.value.trim()).filter(v=>v).join("ã€")||"ç„¡";

  const payload={
    date:document.getElementById("date").value,
    time:document.getElementById("time").value,
    flight:document.getElementById("flightNumber").value.trim().toUpperCase(),
    terminal:document.getElementById("terminal").value,
    start:document.getElementById("startAddress").value.trim(),
    via:viaPoints,
    end:endValue,
    car:document.getElementById("carType").value,
    luggageNote:document.getElementById("luggageNote").value.trim(),
    childSeat:document.getElementById("childSeat").value,
    name:document.getElementById("name").value.trim(),
    phone:document.getElementById("phone").value.trim()
  };

  try{
    const res=await fetch(WEB_APP_URL,{
      method:"POST",
      headers:{"Content-Type":"application/json"},
      body:JSON.stringify(payload)
    });
    const data=await res.json();
    showMsg(data.status==="ok"?"âœ… é ç´„å·²é€å‡º":"âŒ é€å‡ºå¤±æ•—",data.status==="ok"?"success":"error");
    if(data.status==="ok") e.target.reset();
  }catch(err){
    console.error(err);
    showMsg("âŒ é€å‡ºå¤±æ•—ï¼Œè«‹é‡è©¦","error");
  }finally{
    btn.disabled=false;
    btn.textContent="âœ… é€å‡ºé ç´„";
  }
});

function showMsg(text,type){
  const div=document.getElementById("message");
  div.textContent=text;
  div.className=type;
  div.style.display="block";
  setTimeout(()=>{div.style.display="none";},5000);
}
</script>
</body>
</html>
