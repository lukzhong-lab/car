<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>æ¥é€é ç´„è¡¨å–®</title>
<style>
body { font-family: system-ui; background: #111827; color: #f3f4f6; padding: 16px; line-height: 1.6; }
.container { max-width: 640px; margin: auto; background: #1f2937; padding: 20px; border-radius: 14px; box-shadow: 0 4px 12px rgba(0,0,0,0.3); }
h2 { text-align: center; margin-bottom: 24px; }
label { display: block; margin-top: 16px; font-weight: 600; }
input, select, button { width: 100%; box-sizing: border-box; }
input, select { padding: 12px 14px; border-radius: 10px; border: 1px solid #4b5563; background: #374151; color: #f3f4f6; font-size: 16px; }
input[type="number"] { max-width: 120px; display: inline-block; }
.via-container { display: flex; flex-wrap: wrap; gap: 8px; align-items: center; }
.via-container input { flex: 1; }
.time-selects { display: flex; gap: 8px; }
.time-selects select { flex: 1; }
button { margin-top: 24px; padding: 14px; border: none; border-radius: 10px; background: #059669; color: #fff; font-weight: 600; font-size: 16px; cursor: pointer; transition: 0.2s; }
button:hover { background: #10b981; }
.note { font-size: 14px; color: #9ca3af; margin-top: 4px; }
.note.danger { color: #ef4444; font-weight: 600; }
@media (max-width: 480px) { body { padding: 12px; } input, select, button { font-size: 15px; padding: 10px 12px; } }
</style>
</head>
<body>
<div class="container">
<h2>ğŸš— æ¥é€é ç´„è¡¨å–®</h2>
<form id="bookingForm">

<label>ğŸ“… æ—¥æœŸ</label>
<input type="date" name="date" required>
<div class="note" id="weekday"></div>

<label>â° èˆªç­æ™‚é–“</label>
<div class="time-selects">
  <select name="hour" required><option value="">æ™‚</option></select>
  <select name="minute" required><option value="">åˆ†</option></select>
</div>
<div class="note">è«‹é¸æ“‡èˆªç­æ™‚é–“ (24 å°æ™‚åˆ¶)</div>

<label>ğŸ•‘ å»ºè­°å‡ºç™¼æ™‚é–“</label>
<select name="suggestedDeparture" id="suggestedDeparture" required></select>

<label>âœˆï¸ èˆªç­è™Ÿç¢¼</label>
<input type="text" name="flight" placeholder="ä¾‹ï¼šCI123">

<label>ğŸ“ å‡ºç™¼åœ°</label>
<input type="text" name="start" required>

<label>ğŸ›£ï¸ ä¸­é€”åœé </label>
<div id="viaList" class="via-container">
  <input type="text" class="via-item" placeholder="è¼¸å…¥ä¸­é€”åœ°å€">
</div>
<button type="button" onclick="addVia()">â• æ–°å¢åœé é»</button>

<label>ğŸ ç›®çš„åœ°</label>
<select name="end" id="endSelect" required>
  <option value="">è«‹é¸æ“‡</option>
  <option value="è‡ªè¨‚">è‡ªè¨‚åœ°å€</option>
  <option value="æ¡ƒåœ’åœ‹éš›æ©Ÿå ´">æ¡ƒåœ’åœ‹éš›æ©Ÿå ´</option>
</select>
<input id="customEnd" type="text" placeholder="è«‹è¼¸å…¥ç›®çš„åœ°åœ°å€" style="display:none;margin-top:8px">

<div id="terminalBlock" style="display:none;">
  <label>ğŸ›« èˆªå»ˆ</label>
  <select name="terminal" id="terminalSelect">
    <option value="">è«‹é¸æ“‡èˆªå»ˆ</option>
    <option value="T1">T1</option>
    <option value="T2">T2</option>
    <option value="T3">T3</option>
  </select>
</div>

<label>ğŸš˜ è»Šå‹</label>
<select name="car" required>
  <option value="">è«‹é¸æ“‡</option>
  <option value="èˆ’é©è½è»Š">èˆ’é©è½è»Šï¼ˆ1â€“2 ä»¶ï¼‰</option>
  <option value="äº”åº§ä¼‘æ—…">äº”åº§ä¼‘æ—…ï¼ˆ3â€“4 ä»¶ï¼‰</option>
  <option value="7äººåº§">7äººåº§ï¼ˆ3â€“4 ä»¶ï¼‰</option>
  <option value="8-9åº§å¤§è»Š">8â€“9 åº§ï¼ˆ6 ä»¶ä»¥ä¸Šï¼‰</option>
</select>

<label>ğŸ§³ è¡Œæå‚™è¨»</label>
<input type="text" name="luggageNote">

<label>ğŸ‘¶ å…’ç«¥åº§æ¤…</label>
<select name="childSeatType">
  <option value="ä¸éœ€è¦">ä¸éœ€è¦</option>
  <option value="å®‰å…¨åº§æ¤…">å®‰å…¨åº§æ¤…</option>
  <option value="å¢é«˜å¢Š">å¢é«˜å¢Š</option>
</select>
<input type="number" name="childSeatQty" min="1" placeholder="æ•¸é‡">
<div class="note">
âš ï¸ æ³•è¦è¦å®šï¼š<br>
1ï¸âƒ£ 4 æ­²ä»¥ä¸‹æˆ–é«”é‡æœªé” 18kg çš„å…’ç«¥å¿…é ˆä½¿ç”¨å®‰å…¨åº§æ¤…ã€‚<br>
2ï¸âƒ£ 4â€“12 æ­²æˆ–é«”é‡ 18â€“36kg çš„å…’ç«¥å»ºè­°ä½¿ç”¨å¢é«˜å¢Šã€‚<br>
3ï¸âƒ£ è¶…éæ³•å®šå¹´é½¡æˆ–é‡é‡çš„å…’ç«¥å¯ä½¿ç”¨å®‰å…¨å¸¶ã€‚
</div>

<label>ğŸ™‹ å§“å</label>
<input type="text" name="name" required>

<label>ğŸ“ é›»è©±</label>
<input type="tel" name="phone" required>

<button type="submit">âœ… é€å‡ºé ç´„</button>
</form>
<div id="message" style="margin-top:16px;"></div>
</div>

<script>
const form = document.getElementById("bookingForm");
const msg = document.getElementById("message");
const suggestedSelect = document.getElementById("suggestedDeparture");

// æ—¥æœŸæ˜ŸæœŸ
const dateInput = form.querySelector('[name="date"]');
const weekday = document.getElementById("weekday");
dateInput.value = new Date().toISOString().slice(0,10);
updateDay();
dateInput.onchange = updateDay;
function updateDay(){
  const w=["æ—¥","ä¸€","äºŒ","ä¸‰","å››","äº”","å…­"];
  weekday.textContent=`(${w[new Date(dateInput.value).getDay()]})`;
}

// æ–°å¢ä¸­é€”åœé 
function addVia(){
  const i = document.createElement("input");
  i.className = "via-item";
  i.placeholder = "è¼¸å…¥ä¸­é€”åœ°å€";
  document.getElementById("viaList").appendChild(i);
}

// ç›®çš„åœ°è‡ªè¨‚/èˆªå»ˆ
const endSelect = document.getElementById("endSelect");
const customEnd = document.getElementById("customEnd");
const terminalBlock = document.getElementById("terminalBlock");
const terminalSelect = document.getElementById("terminalSelect");
endSelect.addEventListener('change', ()=>{
  const airport = endSelect.value === "æ¡ƒåœ’åœ‹éš›æ©Ÿå ´";
  terminalBlock.style.display = airport ? "block" : "none";
  terminalSelect.required = airport;
  if(endSelect.value==="è‡ªè¨‚"){
    customEnd.style.display="block";
    customEnd.required=true;
  } else {
    customEnd.style.display="none";
    customEnd.required=false;
    customEnd.value="";
  }
});

// æ™‚é–“ä¸‹æ‹‰
const hourSelect = form.querySelector('[name="hour"]');
const minuteSelect = form.querySelector('[name="minute"]');
for(let h=0; h<24; h++){
  const opt = document.createElement('option');
  opt.value = h.toString().padStart(2,'0'); opt.textContent = h.toString().padStart(2,'0');
  hourSelect.appendChild(opt);
}
for(let m=0; m<60; m+=5){
  const opt = document.createElement('option');
  opt.value = m.toString().padStart(2,'0'); opt.textContent = m.toString().padStart(2,'0');
  minuteSelect.appendChild(opt);
}

// å»ºè­°å‡ºç™¼æ™‚é–“ç”Ÿæˆï¼ˆè·¨æ—¥ç´…è‰²é¡¯ç¤ºï¼‰
function updateSuggestedDeparture() {
  const hour = parseInt(hourSelect.value);
  const minute = parseInt(minuteSelect.value);
  if(isNaN(hour) || isNaN(minute)) return;

  suggestedSelect.innerHTML = ""; // æ¸…ç©º

  const flightDate = new Date(dateInput.value);
  flightDate.setHours(hour, minute, 0, 0);

  // ç”Ÿæˆå‰ 4 å°æ™‚åˆ°èˆªç­æ™‚é–“æ¯ 15 åˆ†é˜é¸é …
  for(let mins = 240; mins >= 0; mins -= 15){
    const d = new Date(flightDate.getTime() - mins*60000);
    const y = d.getFullYear();
    const mo = (d.getMonth()+1).toString().padStart(2,'0');
    const da = d.getDate().toString().padStart(2,'0');
    const h = d.getHours().toString().padStart(2,'0');
    const mi = d.getMinutes().toString().padStart(2,'0');
    const opt = document.createElement('option');
    opt.value = `${y}-${mo}-${da} ${h}:${mi}`;
    opt.textContent = `${y}-${mo}-${da} ${h}:${mi}`;

    // åˆ¤æ–·æ˜¯å¦è·¨æ—¥
    if(d.getDate() !== flightDate.getDate()){
      opt.style.color = "red";
    } else {
      opt.style.color = "black";
    }

    suggestedSelect.appendChild(opt);
  }

  suggestedSelect.selectedIndex = 0; // é è¨­é¸å‰ 4 å°æ™‚
}

hourSelect.addEventListener('change', updateSuggestedDeparture);
minuteSelect.addEventListener('change', updateSuggestedDeparture);
dateInput.addEventListener('change', updateSuggestedDeparture);
window.addEventListener('DOMContentLoaded', updateSuggestedDeparture);

// è¡¨å–®é€å‡º
form.onsubmit = e => {
  e.preventDefault();
  let ok = true;
  form.querySelectorAll("[required]").forEach(i => { if(!i.value.trim()) ok=false; });
  if(!ok){ msg.textContent="âš ï¸ è«‹å¡«å¯«æ‰€æœ‰å¿…å¡«æ¬„ä½"; return; }

  const obj = {};
  const formData = new FormData(form);
  formData.forEach((v,k)=>{
    v = v.trim();
    if(v && v!=='ç„¡' && v!=='ä¸éœ€è¦') obj[k] = v;
  });

  // å…’ç«¥åº§æ¤…åˆä½µ
  const type = form.querySelector('[name="childSeatType"]').value;
  const qty = form.querySelector('[name="childSeatQty"]').value.trim();
  if(type && type!=='ä¸éœ€è¦') obj.childSeat = type + (qty?' x'+qty:'');

  // ä¸­é€”åœé 
  const viaList = [...document.querySelectorAll(".via-item")]
    .map(i=>i.value.trim())
    .filter(v => v && v!=='ç„¡');
  if(viaList.length) obj.via = viaList.join(" â• ");

  // è‡ªè¨‚ç›®çš„åœ°
  if(obj.end==='è‡ªè¨‚') obj.end = customEnd.value.trim();

  console.log("é€å‡ºè³‡æ–™:", obj);

  fetch("https://script.google.com/macros/s/AKfycbwG-V_zY5OdBVw7SyQIV8yrsvBDDKQqqisk43m2zsiELAcCixnXPBLPrxIrSiMmsgYE/exec",{
    method:"POST",
    body:new URLSearchParams(obj)
  }).then(r=>r.json())
  .then(r=> msg.textContent = (r.status==="ok"?"âœ… é€å‡ºæˆåŠŸ":"âŒ é€å‡ºå¤±æ•—"))
  .catch(err=> msg.textContent = "âŒ é€å‡ºå¤±æ•—");
};
</script>
</body>
</html>
